<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>XV Sofi</title>
  <link rel="icon" type="image/x-icon" href="./images/sofiicon.png" />
  <style>
    :root {
      /* Base ‚ÄúiPhone 14 Pro Max‚Äù (CSS px) con adaptaci√≥n hacia abajo */
      --device-w: min(100vw, 430px);
      --device-h: min(100svh, 932px);
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: url("./images/background.webp") center center / cover no-repeat;
      color: #fff;
    }

    main {
      display: block;
      width: var(--device-w);
      margin-inline: auto;
    }
  </style>
</head>

<body>
  <main id="app"></main>

  <script type="module">
    import { createHeroBlock } from './blocks/hero.js';
    import { createStack } from './blocks/stack.js';
    import { createCountdown } from './components/countdown.js';
    import { initParallax, initReveal } from './lib/scrollEffects.js';
    import { initGuestModal } from './components/guestModal.js';
    import { initAudioPlayer } from './components/audioPlayer.js';
    import { createSplitHero } from './blocks/splitHero.js';
    import { createGallery } from './blocks/gallery.js';


    const app = document.getElementById('app');

    const guestModal = initGuestModal({
      scriptURL: 'listadeinvitadosvirilili',
      title: 'Lista de invitados',
      description: 'D√©janos tu nombre, cu√°ntas personas vienen y un mensaje opcional.',
      decorTopCenterSrc: './images/flowerstopcenter.webp',
      decorRightCenterSrc: './images/butterfliesrightbig.webp',
      decorLeftCenterSrc: './images/butterfliesleftbig.webp'
    })

    const registry = {
      countdown: (props) => createCountdown(props),
      // en el futuro puedes agregar otros
    };
    const topHero = createSplitHero({
  bgSrc: './images/sofititle.webp',
  side: 'left',                 // 'left' o 'right'
  sideSrc: './images/title.webp',
  ratio: '16 / 9',               // ajusta libremente (p.ej. '3 / 2')
  maxHeight: '70vh'              // opcional
});
app.prepend(topHero);
const player = initAudioPlayer({
  src: './images/sofi.mp3',
  width: 'calc(var(--device-w, 430px) * 0.30)',
  top: 15,
  safeTopPx: 15,
  followAnchor: topHero,   // o '.split-hero'
  followMargin: 12,
  fadeWhileFollowing: false,
  fadeDistancePx: 160
});

    // Define tus bloques como datos (¬°escalable!)
    const blocks = [
      {
        // fondo ya no lo necesitamos, lo dejamos vac√≠o o quitamos la propiedad
        background: '',

        // overlays decorativos (se mantienen absolutos)
        topLeft: './images/butterflieslefttop.webp',
        topRight: './images/butterfliesrighttop.webp',

        // stack con la imagen principal
        stack3: {
          items: [
            { kind: "html", html: "<div style='height:7vh'></div>" },
            {
              kind: "image",
              src: "./images/intro.webp",
              alt: "Imagen principal",
              variant: "principal"   // üëà ocupar√° ~70% del alto
            }
          ]
        }
      },
      {
        background: '',                         // sin fondo
        leftCenter: './images/butterfliesleftbig.webp', // decorativo lateral

        stack3: {
          gap: "10px",
          items: [
            { kind: "image", src: "./images/church.webp", alt: "Cuadrada", variant: "square" },
            {
              kind: "buttonImage",
              src: "./images/mapbutton2.webp",
              alt: "Iglesia",
              variant: "wideText",
              onClick: () => window.open('https://maps.app.goo.gl/9SKv1Xc23EsZLbDQ6', '_blank')
            }
          ]
        }
      }
      ,
      {
        // sin fondo ni parallax
        background: '',
        rightCenter: './images/butterfliesrightbig.webp',

        // el stack crece por contenido (quita heights/width)
        stack3: {
          gap: "8px",
          items: [

            // 2) letrero ancho (si este fuera cuadrado, usa variant: "square")
            { kind: "image", src: "./images/reception.webp", alt: "Cuadrada", variant: "wideText" },

            // 3) bot√≥n (letrero ancho) con su onClick intacto
            {
              kind: "buttonImage",
              src: "./images/mapbutton.webp",
              alt: "Sal√≥n",
              variant: "wideText",
              onClick: () => window.open('https://maps.app.goo.gl/MocggLhSqwr6Aj3H7', '_blank')
            }
          ]
        }
      }
      ,
      {
        // sin fondo ni parallax
        background: '',
        leftCenter: './images/butterfliesleftbig.webp',

        // el stack crece por contenido (quita heights/width)
        stack3: {
          gap: "8px",
          items: [

            // 2) letrero ancho (si este fuera cuadrado, usa variant: "square")
            { kind: "image", src: "./images/program.webp", alt: "Cuadrada", variant: "square" },

            // 3) bot√≥n (letrero ancho) con su onClick intacto

          ]
        }
      }
      ,
      {
        // sin fondo ni parallax; dejamos las decoraciones absolutas
        background: './images/bottombackground.webp',
        bottomCenter: './images/bottombackground.webp',

        stack3: {
          gap: "16px",               // un poco m√°s de aire en el bloque final
          items: [
            { kind: "html", html: "<div style='height:1vh'></div>" },
            // 1) letrero superior
            { kind: "image", src: "./images/dresscode.webp", alt: "Cuadrada", variant: "square" },

            // 2) countdown (escala a ~90% del ancho base del iPhone)

            // 3) bot√≥n de confirmaci√≥n (imagen ancha, centrada)
            {
              kind: "buttonImage",
              src: "./images/confirmbutton.webp",
              alt: "Confirmar asistencia",
              variant: "wideText",
              onClick: () => guestModal.open()
            },
            {
              kind: "node",
              node: registry.countdown({
                target: '2025-11-22T17:00:00-06:00',
                bgSrc: './images/counter.webp',
                digitsPath: d => `./digits/${d}.png`,
                zeroPad: { days: 2, hours: 2, minutes: 2, seconds: 2 },
                showLabels: true,
                // clave: atarlo a tu "device width"
                scaleWidth: 'min(80vw, calc(var(--device-w, 430px) * 0.90))',
              })
            },
            { kind: "html", html: "<div style='height:10vh'></div>" },
          ]
        },
      }

    ];
    


    // Crea y monta todos los bloques
    const nodes = blocks.map((cfg, idx) => {
      const sec = createHeroBlock({ ...cfg, centerNode: null });

      if (cfg.stack3) {
        const s3 = createStack(cfg.stack3);
        sec.appendChild(s3);
      }

      // üëá Si es el √∫ltimo bloque, m√°rcalo como fullscreen
      if (idx === blocks.length - 1) {
        sec.style.marginBottom = '0';
      }

      return sec;
    });



    app.append(...nodes);
    const gallery = createGallery({
  images: [
    './images/sofigal1.jpg',
    './images/sofigal2.jpg',
    './images/sofigal3.jpg',
  ],
  ratio: '16 / 9',
  loop: true,
  openOnClick: true,
  captions: ['','','']
});
app.appendChild(gallery);


    // Efectos de scroll
    // initReveal({ rootMargin: '0px 0px -12% 0px', once: false }); // reversa al hacer scroll back
    //initParallax();
  </script>
</body>

</html>